<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lý cầu thủ</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Danh sách cầu thủ</h1>

<div style="margin-bottom: 20px;">
    <input id="name" placeholder="Tên cầu thủ"><br>
    <input type="date" id="dob" placeholder="Ngày sinh"><br>
    <input type="text" id="exp" placeholder="Kinh nghiệm (VD: 5 năm)"><br> <select id="position">
    <option value="">-- Chọn vị trí --</option>
    <option value="Thủ môn">Thủ môn</option>
    <option value="Hậu vệ">Hậu vệ</option>
    <option value="Tiền vệ">Tiền vệ</option>
    <option value="Tiền đạo">Tiền đạo</option>
</select><br>
    <input id="avatar" placeholder="URL ảnh đại diện"><br>

    <select id="team">
        <option value="">-- Chọn đội --</option>
    </select><br>

    <button id="btn-save">Lưu cầu thủ</button>
</div>

<table border="1" style="border-collapse: collapse; width: 100%;">
    <thead>
    <tr>
        <th>STT</th>
        <th>Tên</th>
        <th>Ngày sinh</th>
        <th>Vị trí</th>
        <th>Kinh nghiệm</th>
        <th>Đội</th>
    </tr>
    </thead>
    <tbody id="content"></tbody>
</table>

<script>
    $(document).ready(function () {
        displayPlayers();
        loadTeams();

        $("#btn-save").click(function () {
             let teamId = $("#team").val();

            let player = {
                name: $("#name").val(),
                dob: $("#dob").val(),
                experience: $("#exp").val(),
                position: $("#position").val(),
                image: $("#avatar").val(),
            };

            if (teamId) {
                player.team = {
                    teamId: teamId
                };
            }

            $.ajax({
                url: "http://localhost:8080/v1/api/players",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(player),
                success: function () {
                    alert("Thêm cầu thủ thành công!");
                    displayPlayers();
                    clearForm();
                },
                error: function (e) {
                    console.log(e);
                    alert("Lỗi khi thêm cầu thủ! (Kiểm tra Console log)");
                }
            });
        });

        function loadTeams() {
            $.ajax({
                url: "http://localhost:8080/v1/api/teams",
                method: "GET",
                dataType: "json",
                success: function (data) {
                    let teamOptions = `<option value="">-- Chọn đội --</option>`;
                    for (let i = 0; i < data.length; i++) {
                        teamOptions += `<option value="${data[i].teamId}">${data[i].teamName}</option>`;
                    }
                    $("#team").html(teamOptions);
                },
                error: function () {
                    $("#team").html("<p value=''>Lỗi tải danh sách đội</p>");
                }
            });
        }

        function displayPlayers() {
            $.ajax({
                url: "http://localhost:8080/v1/api/players",
                method: "GET",
                dataType: "json",
                success: function (data) {
                    let content = "";
                    for (let i = 0; i < data.length; i++) {
                        let player = data[i];
                        content += `
                            <tr>
                                <td>${i + 1}</td>
                                <td>${player.name}</td>
                                <td>${player.dob || ''}</td>
                                <td>${player.position || ''}</td>
                                <td>${player.experience || ''}</td>
                                <td>${player.team ? player.team.teamName : 'Chưa có đội'}</td>
                            </tr>`;
                    }
                    $("#content").html(content);
                },
                error: function () {
                    $("#content").html("<tr><td colspan='6'>Không có dữ liệu cầu thủ</td></tr>");
                }
            });
        }

        function clearForm() {
            $("#name").val('');
            $("#dob").val('');
            $("#exp").val('');
            $("#position").val('');
            $("#avatar").val('');
            $("#team").val('');
        }
    });
</script>
</body>
</html>